# -*- Python -*-

import os
# import sys
# import re
# import platform
# import subprocess

import lit.formats
import lit.util

# Configuration file for the 'lit' test runner.

execute_external = (True)

# Prepare paths related to the custom opt tool
mlir_custom_opt_path = os.path.dirname(os.path.realpath(__file__)) + \
                       '/../../build/compiler/'
mlir_custom_opt_path = os.path.normpath(mlir_custom_opt_path)
mlir_custom_opt_file = 'spnc-opt'
mlir_custom_opt_call = os.path.join(mlir_custom_opt_path, mlir_custom_opt_file)

env_ld_lib = os.environ.get("LD_LIBRARY_PATH")

path = os.path.pathsep.join((mlir_custom_opt_path,
                             config.environment.get('LD_LIBRARY_PATH','')))

# Set actual lit-config
# Note: Setting config.test_exec_root is needed to ensure that test-output is
# not written into the source directory (but into "build").
config.name = "spnc-mlir"
config.environment['LD_LIBRARY_PATH'] = path
config.test_exec_root = os.path.join(mlir_custom_opt_path, "test")
config.test_format = lit.formats.ShTest(execute_external)
config.suffixes = ['.mlir']
config.substitutions.append(('%optcall', mlir_custom_opt_call))

# print(os.path.dirname(os.path.realpath(__file__)))
# print("'{}'".format(mlir_custom_opt_call))
# print("'{}'".format(config.llvm_tools_dir))
# print('\nFIRST OF ALL\n\nADJUST THE memls_dir VARIABLE in ./test/lit.cfg TO YOUR LOCAL MACHINE\n')
# print('CURRENT VALUE OF THE VARIABLE IS ' + memls_dir + '\n')
